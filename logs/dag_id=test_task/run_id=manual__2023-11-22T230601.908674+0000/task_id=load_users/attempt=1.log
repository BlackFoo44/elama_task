[2023-11-22T23:06:05.391+0000] {taskinstance.py:1171} INFO - Dependencies all met for <TaskInstance: test_task.load_users manual__2023-11-22T23:06:01.908674+00:00 [queued]>
[2023-11-22T23:06:05.398+0000] {taskinstance.py:1171} INFO - Dependencies all met for <TaskInstance: test_task.load_users manual__2023-11-22T23:06:01.908674+00:00 [queued]>
[2023-11-22T23:06:05.399+0000] {taskinstance.py:1368} INFO - 
--------------------------------------------------------------------------------
[2023-11-22T23:06:05.399+0000] {taskinstance.py:1369} INFO - Starting attempt 1 of 5
[2023-11-22T23:06:05.400+0000] {taskinstance.py:1370} INFO - 
--------------------------------------------------------------------------------
[2023-11-22T23:06:05.410+0000] {taskinstance.py:1389} INFO - Executing <Task(PythonOperator): load_users> on 2023-11-22 23:06:01.908674+00:00
[2023-11-22T23:06:05.414+0000] {standard_task_runner.py:52} INFO - Started process 238 to run task
[2023-11-22T23:06:05.416+0000] {standard_task_runner.py:79} INFO - Running: ['***', 'tasks', 'run', 'test_task', 'load_users', 'manual__2023-11-22T23:06:01.908674+00:00', '--job-id', '214', '--raw', '--subdir', 'DAGS_FOLDER/add_data_dag.py', '--cfg-path', '/tmp/tmprygz_65b', '--error-file', '/tmp/tmpaj6gwlaz']
[2023-11-22T23:06:05.417+0000] {standard_task_runner.py:80} INFO - Job 214: Subtask load_users
[2023-11-22T23:06:05.465+0000] {task_command.py:371} INFO - Running <TaskInstance: test_task.load_users manual__2023-11-22T23:06:01.908674+00:00 [running]> on host 54bfe75eb29c
[2023-11-22T23:06:05.521+0000] {taskinstance.py:1583} INFO - Exporting the following env vars:
AIRFLOW_CTX_DAG_EMAIL=***@example.com
AIRFLOW_CTX_DAG_OWNER=***
AIRFLOW_CTX_DAG_ID=test_task
AIRFLOW_CTX_TASK_ID=load_users
AIRFLOW_CTX_EXECUTION_DATE=2023-11-22T23:06:01.908674+00:00
AIRFLOW_CTX_TRY_NUMBER=1
AIRFLOW_CTX_DAG_RUN_ID=manual__2023-11-22T23:06:01.908674+00:00
[2023-11-22T23:06:05.526+0000] {log.py:128} INFO - select pg_catalog.version()
[2023-11-22T23:06:05.527+0000] {log.py:128} INFO - [raw sql] {}
[2023-11-22T23:06:05.527+0000] {log.py:128} INFO - select current_schema()
[2023-11-22T23:06:05.528+0000] {log.py:128} INFO - [raw sql] {}
[2023-11-22T23:06:05.529+0000] {log.py:128} INFO - show standard_conforming_strings
[2023-11-22T23:06:05.529+0000] {log.py:128} INFO - [raw sql] {}
[2023-11-22T23:06:05.536+0000] {log.py:128} INFO - select relname from pg_class c join pg_namespace n on n.oid=c.relnamespace where pg_catalog.pg_table_is_visible(c.oid) and relname=%(name)s
[2023-11-22T23:06:05.536+0000] {log.py:128} INFO - [generated in 0.00042s] {'name': 'users'}
[2023-11-22T23:06:05.538+0000] {log.py:128} INFO - select relname from pg_class c join pg_namespace n on n.oid=c.relnamespace where pg_catalog.pg_table_is_visible(c.oid) and relname=%(name)s
[2023-11-22T23:06:05.538+0000] {log.py:128} INFO - [cached since 0.001887s ago] {'name': 'users'}
[2023-11-22T23:06:05.539+0000] {log.py:128} INFO - SELECT c.relname FROM pg_class c JOIN pg_namespace n ON n.oid = c.relnamespace WHERE n.nspname = %(schema)s AND c.relkind in ('r', 'p')
[2023-11-22T23:06:05.539+0000] {log.py:128} INFO - [generated in 0.00027s] {'schema': 'public'}
[2023-11-22T23:06:05.540+0000] {log.py:128} INFO - 
            SELECT c.oid
            FROM pg_catalog.pg_class c
            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
            WHERE (pg_catalog.pg_table_is_visible(c.oid))
            AND c.relname = %(table_name)s AND c.relkind in
            ('r', 'v', 'm', 'f', 'p')
        
[2023-11-22T23:06:05.541+0000] {log.py:128} INFO - [generated in 0.00031s] {'table_name': 'users'}
[2023-11-22T23:06:05.542+0000] {log.py:128} INFO - 
            SELECT a.attname,
              pg_catalog.format_type(a.atttypid, a.atttypmod),
              (
                SELECT pg_catalog.pg_get_expr(d.adbin, d.adrelid)
                FROM pg_catalog.pg_attrdef d
                WHERE d.adrelid = a.attrelid AND d.adnum = a.attnum
                AND a.atthasdef
              ) AS DEFAULT,
              a.attnotnull,
              a.attrelid as table_oid,
              pgd.description as comment,
              a.attgenerated as generated,
                              (SELECT json_build_object(
                    'always', a.attidentity = 'a',
                    'start', s.seqstart,
                    'increment', s.seqincrement,
                    'minvalue', s.seqmin,
                    'maxvalue', s.seqmax,
                    'cache', s.seqcache,
                    'cycle', s.seqcycle)
                FROM pg_catalog.pg_sequence s
                JOIN pg_catalog.pg_class c on s.seqrelid = c."oid"
                WHERE c.relkind = 'S'
                AND a.attidentity != ''
                AND s.seqrelid = pg_catalog.pg_get_serial_sequence(
                    a.attrelid::regclass::text, a.attname
                )::regclass::oid
                ) as identity_options                
            FROM pg_catalog.pg_attribute a
            LEFT JOIN pg_catalog.pg_description pgd ON (
                pgd.objoid = a.attrelid AND pgd.objsubid = a.attnum)
            WHERE a.attrelid = %(table_oid)s
            AND a.attnum > 0 AND NOT a.attisdropped
            ORDER BY a.attnum
        
[2023-11-22T23:06:05.542+0000] {log.py:128} INFO - [generated in 0.00035s] {'table_oid': 17265}
[2023-11-22T23:06:05.544+0000] {log.py:128} INFO - 
            SELECT t.typname as "name",
               pg_catalog.format_type(t.typbasetype, t.typtypmod) as "attype",
               not t.typnotnull as "nullable",
               t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema"
            FROM pg_catalog.pg_type t
               LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
            WHERE t.typtype = 'd'
        
[2023-11-22T23:06:05.544+0000] {log.py:128} INFO - [generated in 0.00029s] {}
[2023-11-22T23:06:05.545+0000] {log.py:128} INFO - 
            SELECT t.typname as "name",
               -- no enum defaults in 8.4 at least
               -- t.typdefault as "default",
               pg_catalog.pg_type_is_visible(t.oid) as "visible",
               n.nspname as "schema",
               e.enumlabel as "label"
            FROM pg_catalog.pg_type t
                 LEFT JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace
                 LEFT JOIN pg_catalog.pg_enum e ON t.oid = e.enumtypid
            WHERE t.typtype = 'e'
        ORDER BY "schema", "name", e.oid
[2023-11-22T23:06:05.546+0000] {log.py:128} INFO - [generated in 0.00039s] {}
[2023-11-22T23:06:05.547+0000] {log.py:128} INFO - 
                SELECT a.attname
                FROM pg_attribute a JOIN (
                    SELECT unnest(ix.indkey) attnum,
                           generate_subscripts(ix.indkey, 1) ord
                    FROM pg_index ix
                    WHERE ix.indrelid = %(table_oid)s AND ix.indisprimary
                    ) k ON a.attnum=k.attnum
                WHERE a.attrelid = %(table_oid)s
                ORDER BY k.ord
            
[2023-11-22T23:06:05.547+0000] {log.py:128} INFO - [generated in 0.00029s] {'table_oid': 17265}
[2023-11-22T23:06:05.548+0000] {log.py:128} INFO - 
        SELECT conname
           FROM  pg_catalog.pg_constraint r
           WHERE r.conrelid = %(table_oid)s AND r.contype = 'p'
           ORDER BY 1
        
[2023-11-22T23:06:05.549+0000] {log.py:128} INFO - [generated in 0.00030s] {'table_oid': 17265}
[2023-11-22T23:06:05.550+0000] {log.py:128} INFO - 
          SELECT r.conname,
                pg_catalog.pg_get_constraintdef(r.oid, true) as condef,
                n.nspname as conschema
          FROM  pg_catalog.pg_constraint r,
                pg_namespace n,
                pg_class c

          WHERE r.conrelid = %(table)s AND
                r.contype = 'f' AND
                c.oid = confrelid AND
                n.oid = c.relnamespace
          ORDER BY 1
        
[2023-11-22T23:06:05.550+0000] {log.py:128} INFO - [generated in 0.00031s] {'table': 17265}
[2023-11-22T23:06:05.551+0000] {log.py:128} INFO - 
              SELECT
                  i.relname as relname,
                  ix.indisunique, ix.indexprs,
                  a.attname, a.attnum, c.conrelid, ix.indkey::varchar,
                  ix.indoption::varchar, i.reloptions, am.amname,
                  pg_get_expr(ix.indpred, ix.indrelid),
                  ix.indnkeyatts as indnkeyatts
              FROM
                  pg_class t
                        join pg_index ix on t.oid = ix.indrelid
                        join pg_class i on i.oid = ix.indexrelid
                        left outer join
                            pg_attribute a
                            on t.oid = a.attrelid and a.attnum = ANY(ix.indkey)
                        left outer join
                            pg_constraint c
                            on (ix.indrelid = c.conrelid and
                                ix.indexrelid = c.conindid and
                                c.contype in ('p', 'u', 'x'))
                        left outer join
                            pg_am am
                            on i.relam = am.oid
              WHERE
                  t.relkind IN ('r', 'v', 'f', 'm', 'p')
                  and t.oid = %(table_oid)s
                  and ix.indisprimary = 'f'
              ORDER BY
                  t.relname,
                  i.relname
            
[2023-11-22T23:06:05.552+0000] {log.py:128} INFO - [generated in 0.00032s] {'table_oid': 17265}
[2023-11-22T23:06:05.553+0000] {log.py:128} INFO - 
            SELECT
                cons.conname as name,
                cons.conkey as key,
                a.attnum as col_num,
                a.attname as col_name
            FROM
                pg_catalog.pg_constraint cons
                join pg_attribute a
                  on cons.conrelid = a.attrelid AND
                    a.attnum = ANY(cons.conkey)
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'u'
        
[2023-11-22T23:06:05.554+0000] {log.py:128} INFO - [generated in 0.00030s] {'table_oid': 17265}
[2023-11-22T23:06:05.554+0000] {log.py:128} INFO - 
            SELECT
                cons.conname as name,
                pg_get_constraintdef(cons.oid) as src
            FROM
                pg_catalog.pg_constraint cons
            WHERE
                cons.conrelid = %(table_oid)s AND
                cons.contype = 'c'
        
[2023-11-22T23:06:05.555+0000] {log.py:128} INFO - [generated in 0.00030s] {'table_oid': 17265}
[2023-11-22T23:06:05.555+0000] {log.py:128} INFO - 
            SELECT
                pgd.description as table_comment
            FROM
                pg_catalog.pg_description pgd
            WHERE
                pgd.objsubid = 0 AND
                pgd.objoid = %(table_oid)s
        
[2023-11-22T23:06:05.556+0000] {log.py:128} INFO - [generated in 0.00026s] {'table_oid': 17265}
[2023-11-22T23:06:05.556+0000] {log.py:128} INFO - 
DROP TABLE users
[2023-11-22T23:06:05.557+0000] {log.py:128} INFO - [no key 0.00024s] {}
[2023-11-22T23:06:05.557+0000] {log.py:128} INFO - COMMIT
[2023-11-22T23:06:05.560+0000] {log.py:128} INFO - 
CREATE TABLE users (
	user_id BIGINT, 
	email TEXT, 
	date_registration TEXT
)


[2023-11-22T23:06:05.561+0000] {log.py:128} INFO - [no key 0.00036s] {}
[2023-11-22T23:06:05.565+0000] {log.py:128} INFO - COMMIT
[2023-11-22T23:06:05.567+0000] {log.py:128} INFO - BEGIN (implicit)
[2023-11-22T23:06:05.568+0000] {log.py:128} INFO - INSERT INTO users (user_id, email, date_registration) VALUES (%(user_id)s, %(email)s, %(date_registration)s)
[2023-11-22T23:06:05.568+0000] {log.py:128} INFO - [generated in 0.00047s] ({'user_id': 456451, 'email': 'test111@emeil.ru', 'date_registration': '2016-06-08 15:00:00'}, {'user_id': 456481, 'email': 'dododo@test.ru', 'date_registration': '2016-04-22 15:00:00'}, {'user_id': 46545, 'email': 'test111@emeil.ru', 'date_registration': '2016-04-21 15:00:00'}, {'user_id': 456281, 'email': 'ttest@test.ru', 'date_registration': '2016-03-22 15:00:00'}, {'user_id': 44545, 'email': 'test111@emeil.ru', 'date_registration': '2016-05-02 15:00:00'}, {'user_id': 123213, 'email': '111111@test.com', 'date_registration': '2016-06-02 15:00:00'}, {'user_id': 35656, 'email': 'test222@emeil.ru', 'date_registration': '2016-03-02 15:00:00'}, {'user_id': 35657, 'email': 'test222@emeil.ru', 'date_registration': '2016-05-02 15:00:00'})
[2023-11-22T23:06:05.570+0000] {log.py:128} INFO - COMMIT
[2023-11-22T23:06:05.571+0000] {add_data.py:20} INFO - Данные успешно загружены.
[2023-11-22T23:06:05.572+0000] {python.py:173} INFO - Done. Returned value was: None
[2023-11-22T23:06:05.583+0000] {taskinstance.py:1412} INFO - Marking task as SUCCESS. dag_id=test_task, task_id=load_users, execution_date=20231122T230601, start_date=20231122T230605, end_date=20231122T230605
[2023-11-22T23:06:05.628+0000] {local_task_job.py:156} INFO - Task exited with return code 0
[2023-11-22T23:06:05.668+0000] {local_task_job.py:279} INFO - 1 downstream tasks scheduled from follow-on schedule check
